Running a replication log recorder in a ZEO server
==================================================

A replication log recorder can be run in a ZEO server.  The only part
of the ZEO protocol it supports is lastTransaction.

    >>> addr, _ = start_server("""
    ...     %import zc.zrs
    ...     <zrs>
    ...         replicate-to ./primary.sock
    ...         <filestorage>
    ...             path data.fs
    ...         </filestorage>
    ...     </zrs>
    ... """)

    >>> import os
    >>> os.mkdir('log')
    >>> logaddr, _ = start_server("""
    ...     %import zc.zrs
    ...     <replicationlog>
    ...         replicate-from ./primary.sock
    ...         destination log
    ...     </replicationlog>
    ... """)

    >>> import ZEO.ClientStorage, ZEO.tests.forker, transaction
    >>> db = ZEO.DB(addr)
    >>> conn = db.open()
    >>> conn.root()[0] = 0
    >>> transaction.commit()

    >>> log = ZEO.ClientStorage.ClientStorage(logaddr, read_only=True)
    >>> ZEO.tests.forker.wait_until(
    ...     "Log last transaction is the primary last transaction",
    ...     lambda :
    ...     log._server.lastTransaction()
    ...      == db.storage._server.lastTransaction()
    ...     )

    >>> print os.stat(os.path.join('log', '0000000000000000')).st_size
    353

    >>> db.close()
    >>> log.close()
